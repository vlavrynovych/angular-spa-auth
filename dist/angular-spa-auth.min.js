"use strict";!function(){var t={UNAUTHORIZED_REDIRECT_TO_LOGIN:"Unauthorized: redirecting to the login page",MISSING_CURRENT_USER_ENDPOINT:"Endpoint for current user is not specified",MISSING_LOGIN_ENDPOINT:"Login endpoint is not specified",MISSING_LOGOUT_ENDPOINT:"Logout endpoint is not specified",SUCCESS_AUTH:"Successfully authenticated",ERROR_OCCURS:"Error occurs",CANNOT_OVERRIDE_CORE:"You cannot override core service methods. Please use handlers to customize your auth process: "};angular.module("angular-spa-auth",["ngRoute"]).run(["$rootScope","$location","$timeout","AuthService",function(e,r,n,o){o.saveTarget(),e.$on("$routeChangeStart",function(e,i){o.isAuthenticated()?console.info("Loading "+r.path()):i.$$route&&!o.isPublic(i.$$route.originalPath)&&(e.preventDefault(),n(function(){console.info(t.UNAUTHORIZED_REDIRECT_TO_LOGIN),o.openLogin()}))})}]).service("AuthService",["$rootScope","$q","$http","$location",function(e,r,n,o){function i(t){g.verbose&&console.info(t)}function u(t){o.path(t)}function s(){return g.endpoints.isAuthenticated?n.get(g.endpoints.isAuthenticated).then(function(t){var e=JSON.parse(t.data);return i("isAuthenticated: "+e),e||r.reject(t.data)}):r(function(t,e){t(!0)})}function c(){s().then(function(){l.refreshCurrentUser().then(g.handlers.success,g.handlers.error)["catch"](a)})}function a(){u(g.uiRoutes.login)}var g={verbose:!1,publicUrls:["/login","/home"],endpoints:{isAuthenticated:null,currentUser:null,logout:"/logout",login:"/login"},uiRoutes:{login:"/login",home:"/home",target:null},handlers:{getHomePage:function(t){return g.uiRoutes.home},getUser:function(){if(!g.endpoints.currentUser)throw new Error(t.MISSING_CURRENT_USER_ENDPOINT);return n.get(g.endpoints.currentUser).then(function(t){return i("current user: "+JSON.stringify(t.data)),t.data})},login:function(e){if(!g.endpoints.login)throw new Error(t.MISSING_LOGIN_ENDPOINT);return n.post(g.endpoints.login,e)},logout:function(){if(!g.endpoints.logout)throw new Error(t.MISSING_LOGOUT_ENDPOINT);return n.get(g.endpoints.logout).then(function(){e.currentUser=null,a()},function(t){console.error(t)})},success:function(e){i(t.SUCCESS_AUTH)},error:function(e){g.verbose&&console.error(t.ERROR_OCCURS,e)}},mixins:{}},l={config:g,isPublic:function(t){return g.publicUrls.some(function(e){return t&&e.startsWith(t)})},saveTarget:function(){g.uiRoutes.target=o.path(),i("Target route is saved: "+g.uiRoutes.target)},openTarget:function(){g.uiRoutes.target=g.uiRoutes.target||g.handlers.getHomePage(e.currentUser),u(g.uiRoutes.target),i("Redirected to the target route: "+g.uiRoutes.target),l.clearTarget()},clearTarget:function(){g.uiRoutes.target=null},openLogin:a,openHome:function(){u(g.handlers.getHomePage(e.currentUser))},getCurrentUser:function(){return e.currentUser?e.currentUser:l.refreshCurrentUser()},refreshCurrentUser:function(){return g.handlers.getUser().then(function(t){return e.currentUser=t,l.openTarget(),t})},isAuthenticated:function(){return!!e.currentUser},logout:function(){return g.handlers.logout()},run:function(e){if(e&&(g=angular.merge(g,e),e.mixins)){for(var r in e.mixins)if(l.hasOwnProperty(r))throw new Error(t.CANNOT_OVERRIDE_CORE+r);angular.merge(l,e.mixins)}c()},login:function(t){g.handlers.login(t).then(l.refreshCurrentUser).then(g.handlers.success)["catch"](g.handlers.error)}};return l}])}(),String.prototype.startsWith||!function(){var t=function(){try{var t={},e=Object.defineProperty,r=e(t,t,t)&&e}catch(n){}return r}(),e={}.toString,r=function(t){if(null==this)throw TypeError();var r=String(this);if(t&&"[object RegExp]"==e.call(t))throw TypeError();var n=r.length,o=String(t),i=o.length,u=arguments.length>1?arguments[1]:void 0,s=u?Number(u):0;s!=s&&(s=0);var c=Math.min(Math.max(s,0),n);if(i+c>n)return!1;for(var a=-1;++a<i;)if(r.charCodeAt(c+a)!=o.charCodeAt(a))return!1;return!0};t?t(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();
//# sourceMappingURL=angular-spa-auth.min.js.map
